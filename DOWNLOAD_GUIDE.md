# QMSローカルアプリ - ダウンロード・インストールガイド

## 📦 現在の状況

✅ **アプリケーション開発**: 完了
✅ **全機能実装**: 完了
✅ **ビルド確認**: 成功
✅ **初回起動セットアップ**: 実装済み

⚠️ **配布用インストーラー**: 未作成（ローカルMacで作成可能）

---

## 🎯 2つの方法

### **方法1: 配布用インストーラーを作成してダウンロード提供（推奨）**
ユーザーは.dmgまたは.exeファイルをダウンロードし、通常のアプリと同じようにインストール

### **方法2: 開発モードで直接実行**
開発者向け。Node.jsとnpmがインストールされている環境で実行

---

## 🚀 方法1: 配布用インストーラーの作成（推奨）

### **ステップ1: ローカルMacの準備**

#### 1-1. Xcode Command Line Toolsのインストール

```bash
xcode-select --install
```

インストール後、確認：
```bash
xcode-select -p
# 出力例: /Library/Developer/CommandLineTools
```

#### 1-2. プロジェクトの取得

**オプションA: Gitからクローン**
```bash
git clone [このプロジェクトのURL]
cd qms-local-app
```

**オプションB: ZIPファイルをダウンロード**
1. プロジェクトのZIPファイルをダウンロード
2. 解凍
3. ターミナルで解凍したフォルダに移動

#### 1-3. 依存関係のインストール

```bash
npm install
```

所要時間: 約2-3分

---

### **ステップ2: インストーラーの作成**

```bash
npm run package
```

**処理内容：**
1. TypeScriptコンパイル
2. Reactアプリビルド
3. Electronメインプロセスビルド
4. better-sqlite3のネイティブモジュール再ビルド（Electron用）
5. プラットフォーム別インストーラー作成

**所要時間**: 約3-5分

**出力：**
```
dist/
├── qms-local-app-0.1.0.dmg          # macOS用インストーラー (約80-100MB)
├── qms-local-app-0.1.0.exe          # Windows用インストーラー (約90-110MB)
└── qms-local-app-0.1.0-arm64.dmg    # Apple Silicon用 (オプション)
```

---

### **ステップ3: インストーラーの配布**

作成されたインストーラーファイルを以下の方法で配布：

#### **配布方法**
1. **ウェブサイト**
   - ダウンロードページを作成
   - .dmg / .exeファイルをアップロード
   - ダウンロードリンクを提供

2. **メール**
   - ファイルサイズが大きいため、圧縮推奨
   - または、ファイル転送サービス（Dropbox, Google Drive等）を利用

3. **USBメモリ**
   - インストーラーをUSBメモリにコピー
   - 顧客に直接渡す

4. **社内ファイルサーバー**
   - 社内ネットワークの共有フォルダに配置
   - 社員がダウンロード可能

---

### **ステップ4: ユーザーのインストール手順**

#### **macOS の場合**

1. **ダウンロード**
   - `qms-local-app-0.1.0.dmg` をダウンロード

2. **インストール**
   - .dmgファイルをダブルクリック
   - 開いたウィンドウで、アプリアイコンを「Applications」フォルダにドラッグ

3. **初回起動**
   - Applicationsフォルダを開く
   - 「QMS Local App」をダブルクリック
   - macOSのセキュリティ警告が表示される場合：
     - 「システム環境設定」→「セキュリティとプライバシー」
     - 「このまま開く」をクリック

4. **自動セットアップ（数秒）**
   - 初回起動時に自動実行
   - ディレクトリ作成
   - データベース初期化
   - デフォルトユーザー登録

5. **使用開始**
   - ダッシュボード画面が表示
   - すぐに使用可能

**所要時間**: 5分以内

---

#### **Windows の場合**

1. **ダウンロード**
   - `qms-local-app-0.1.0.exe` をダウンロード

2. **インストール**
   - .exeファイルをダブルクリック
   - インストーラーの指示に従う
   - インストール先を選択（デフォルト: `C:\Program Files\QMS Local App`）
   - 「インストール」をクリック

3. **初回起動**
   - デスクトップまたはスタートメニューから「QMS Local App」をクリック
   - Windowsファイアウォール警告が表示される場合：
     - 「アクセスを許可する」をクリック（ただし、このアプリは外部通信しません）

4. **自動セットアップ（数秒）**
   - 初回起動時に自動実行
   - ディレクトリ作成
   - データベース初期化
   - デフォルトユーザー登録

5. **使用開始**
   - ダッシュボード画面が表示
   - すぐに使用可能

**所要時間**: 5分以内

---

## 🛠️ 方法2: 開発モードで直接実行

開発者向けの方法です。Node.jsとnpmがインストールされている必要があります。

### **要件**
- Node.js 16以上
- npm 8以上

### **手順**

1. **プロジェクトの取得**
```bash
git clone [このプロジェクトのURL]
cd qms-local-app
```

2. **依存関係のインストール**
```bash
npm install
```

3. **開発モードで起動**
```bash
npm run dev
```

4. **別ターミナルでElectronを起動**
```bash
npm run electron:dev
```

**注意**: この方法では、初回起動セットアップは正常に動作しますが、配布には適しません。

---

## 📋 インストール後の確認

### **動作確認チェックリスト**

✅ **1. アプリが起動する**
- ダブルクリックでアプリが起動すること

✅ **2. ダッシュボードが表示される**
- 初回起動後、ダッシュボード画面が表示されること

✅ **3. デフォルトユーザーが登録されている**
- ユーザー選択で4名のデフォルトユーザーが表示されること

✅ **4. 苦情処理記録を作成できる**
- 「苦情処理記録」→「新規作成」で記録を作成できること

✅ **5. PDF出力ができる**
- 作成した記録の「PDF出力」ボタンでPDFが生成されること

---

## 🔧 トラブルシューティング

### **macOS: 「開発元が未確認のため開けません」**

**原因**: macOSのGatekeeperが未署名のアプリをブロック

**解決策**:
1. 「システム環境設定」→「セキュリティとプライバシー」を開く
2. 「一般」タブで「このまま開く」をクリック

または、コマンドで許可：
```bash
xargs -0 -n1 spctl --add < <(mdfind "kMDItemCFBundleIdentifier = 'com.qms-local-app'")
```

---

### **Windows: 「WindowsによってPCが保護されました」**

**原因**: Windows SmartScreenが未署名のアプリをブロック

**解決策**:
1. 「詳細情報」をクリック
2. 「実行する」をクリック

---

### **起動後、ダッシュボードが表示されない**

**原因**: 初回セットアップが失敗した可能性

**解決策**:
1. アプリを終了
2. データフォルダを削除：
   - macOS: `~/Library/Application Support/qms-local-app/`
   - Windows: `%APPDATA%\qms-local-app\`
3. アプリを再起動（自動セットアップが再実行される）

---

### **データベースエラーが表示される**

**原因**: better-sqlite3のネイティブモジュールが正しくビルドされていない

**解決策**:
ローカルMacで再パッケージング：
```bash
npm run package
```

---

## 📊 システム要件

### **macOS**
- OS: macOS 10.15 (Catalina) 以上
- CPU: Intel / Apple Silicon
- メモリ: 2GB以上推奨
- ストレージ: 200MB（アプリ本体） + データ容量

### **Windows**
- OS: Windows 10 / 11 (64bit)
- CPU: Intel / AMD
- メモリ: 2GB以上推奨
- ストレージ: 200MB（アプリ本体） + データ容量

---

## 🔐 セキュリティ

### **このアプリは安全ですか？**

✅ **完全ローカル動作**
- インターネット接続不要
- 外部サーバーへの通信ゼロ

✅ **データの保存場所**
- OS標準のユーザーデータディレクトリ
- OSのファイルシステム権限で保護

✅ **オープンソース（オプション）**
- ソースコードを公開すれば、第三者が安全性を確認可能

---

## 💾 データのバックアップ

### **バックアップ方法**

データフォルダ全体をコピー：

**macOS:**
```bash
cp -r ~/Library/Application\ Support/qms-local-app ~/Documents/qms-backup/
```

**Windows:**
```bash
xcopy %APPDATA%\qms-local-app C:\Backup\qms-local-app /E /I
```

または、アプリ内のエクスポート機能を使用：
- 「設定」→「エクスポート」→「JSONバックアップ」

---

## 🆕 アップデート方法

### **新しいバージョンがリリースされた場合**

1. 新しいバージョンのインストーラーをダウンロード
2. 既存のアプリを終了
3. 新しいインストーラーを実行
4. 既存のデータは自動的に引き継がれる

**注意**: アップデート前にバックアップを推奨

---

## 📞 サポート

### **問題が解決しない場合**

1. **ドキュメントを確認**
   - README.md
   - FIRST_RUN_SETUP.md
   - docs/FEATURES.md

2. **ログファイルを確認**
   - macOS: `~/Library/Logs/qms-local-app/`
   - Windows: `%APPDATA%\qms-local-app\logs\`

3. **サポートに問い合わせ**
   - メール: support@example.com（例）
   - ログファイルを添付すると解決が早くなります

---

## ✨ まとめ

### **配布用インストーラーの作成（ローカルMac）**

```bash
# 1. Xcode Command Line Toolsインストール
xcode-select --install

# 2. プロジェクトの準備
cd qms-local-app
npm install

# 3. インストーラー作成
npm run package

# 4. 配布
# dist/qms-local-app-0.1.0.dmg を配布
```

### **ユーザーのインストール**

1. インストーラーをダウンロード
2. ダブルクリックしてインストール
3. アプリを起動
4. 自動セットアップ（数秒）
5. すぐに使用開始

**所要時間**: 5分以内

---

**QMSローカルアプリは、ダウンロードして5分で使い始められます。**
